"use strict";(self.webpackChunkbooking_app=self.webpackChunkbooking_app||[]).push([[1650],{1650:(w,u,a)=>{a.r(u),a.d(u,{MessagePageModule:()=>E});var m=a(6895),_=a(9299),f=a(2289),e=a(4650),h=a(727),y=a(2972),g=a(7009),l=a(2684),p=a(1321),v=a(9083),M=a(7392);function k(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",10),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.togleDrawer())}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function T(i,c){1&i&&(e.TgZ(0,"span"),e._uU(1,"You: "),e.qZA())}const I=function(i){return{"active-card-list":i}};function Z(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",11),e.NdJ("click",function(){const o=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.handleGetRoomMessages(o._id,r.limit,1))}),e.TgZ(1,"div",12),e._uU(2),e.qZA(),e.TgZ(3,"div",13)(4,"div",14),e._UZ(5,"img",15),e.qZA(),e.TgZ(6,"div",16)(7,"div",17),e._uU(8),e.qZA(),e.TgZ(9,"div",18),e.YNc(10,T,2,0,"span",19),e._uU(11),e.qZA()()()()}if(2&i){const t=c.$implicit,n=e.oxw();e.Q6J("ngClass",e.VKq(7,I,n.activeRoomDetails&&n.activeRoomDetails._id===(null==t?null:t._id))),e.xp6(2),e.Oqu(n.duration(t.lastMsg)),e.xp6(3),e.Q6J("src",n.imgSrc(t.members),e.LSH)("draggable",!1),e.xp6(3),e.Oqu(n.fullName(t.members)),e.xp6(2),e.Q6J("ngIf",n.isAuthor(t)),e.xp6(1),e.hij("",t.msgPrev," ")}}let P=(()=>{class i{constructor(t,n,s){this._message=t,this._token=n,this._util=s,this.isMobile=!1,this.limit=20,this.page=1,this.setMessages=new e.vpe,this.setSelectedId=new e.vpe,this.setRoomDetails=new e.vpe,this.messageList=[],this.subscription=new h.w0,this._snack=(0,e.f3M)(g.ux)}ngOnInit(){this.token=this._token.decodedToken(),this.subscription.add(this._message.getMessageRoomsByUserId(this.token.sub).subscribe({next:t=>{this.messageList=this.sortMessageList(t)},error:t=>{this._snack.open(t.error.code,"",{duration:1e3})}}))}sortMessageList(t){return t.sort((n,s)=>new Date(s.lastMsg).getTime()-new Date(n.lastMsg).getTime())}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}handleGetRoomMessages(t,n,s){1===s&&this.setMessages.emit([]),this.subscription.add(this._message.getRoomMessages(t,n,s).subscribe({next:o=>{if(o.length>0){const r=this.messageList.find($=>$._id===t),C=this.sortMessage(o);this.setMessages.emit(C),this.setSelectedId.emit(C[0]._id),this.setRoomDetails.emit(r),this.activeRoomDetails=r,this.page=s}},error:o=>{this._snack.open(o.code,"",{duration:1e3})}}))}sortMessage(t){return t.sort((n,s)=>new Date(s.createdAt).getTime()-new Date(n.createdAt).getTime())}updateRoomData(t){"text"===t.type&&(this.activeRoomDetails.msgPrev=t.text),this.activeRoomDetails.lastMsg=t.createdAt,this.activeRoomDetails.from=t.from._id,this.messageList=this.sortMessageList(this.messageList)}getOtherMember(t){return t.find(s=>s._id!==this.token.sub)}fullName(t){const n=this.getOtherMember(t);return this._util.constructName(n?.name)}imgSrc(t){const n=this.getOtherMember(t);return this._util.setImgUrl(n?.img)}duration(t){return this._util.calculateMessageDuration(t)}isAuthor(t){return t.from===this.token.sub}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(l.e),e.Y36(p.B),e.Y36(v.M))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-message-sidenav"]],inputs:{isMobile:"isMobile",togleDrawer:"togleDrawer",limit:"limit",page:"page"},outputs:{setMessages:"setMessages",setSelectedId:"setSelectedId",setRoomDetails:"setRoomDetails"},decls:13,vars:2,consts:[[1,"left-column"],[1,"left-column-header"],[1,"title_wrapper"],[1,"title"],["class","custom-close-btn",3,"click",4,"ngIf"],[1,"message-search"],[1,"icon"],["type","text","name","search-listing","placeholder","Search","value",""],[1,"list-card-message"],["class","list-card card-list-message",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"custom-close-btn",3,"click"],[1,"list-card","card-list-message",3,"ngClass","click"],[1,"time-sent"],[1,"list-card-content"],[1,"avatar"],["loading","lazy","alt","Avatar",3,"src","draggable"],[1,"message-name"],[1,"name"],[1,"message"],[4,"ngIf"]],template:function(n,s){1&n&&(e.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"Messages"),e.qZA(),e.YNc(5,k,3,0,"div",4),e.qZA(),e.TgZ(6,"div",5)(7,"div",6)(8,"mat-icon"),e._uU(9,"search"),e.qZA()(),e._UZ(10,"input",7),e.qZA()(),e.TgZ(11,"div",8),e.YNc(12,Z,12,9,"div",9),e.qZA()()),2&n&&(e.xp6(5),e.Q6J("ngIf",s.isMobile),e.xp6(7),e.Q6J("ngForOf",s.messageList))},dependencies:[m.mk,m.sg,m.O5,M.Hw],styles:[".card-list-message[_ngcontent-%COMP%]{background-color:#fff;box-shadow:none;border:1px solid rgba(128,128,128,.247);border-radius:5px;cursor:pointer}.card-list-message[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.left-column[_ngcontent-%COMP%]{padding:1rem;padding-top:0;flex:1;display:flex;flex-direction:column;box-shadow:1px 1px 5px #8887;border-radius:5px;height:100%;overflow-y:auto;position:relative;border-right:1px solid lightgray}.left-column-header[_ngcontent-%COMP%]{padding-top:1rem;background-color:#fff;position:sticky;top:0;z-index:2;padding-bottom:1rem}.left-column-header[_ngcontent-%COMP%]   .title_wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.left-column-header[_ngcontent-%COMP%]   .title_wrapper[_ngcontent-%COMP%]   .custom-close-btn[_ngcontent-%COMP%]{position:absolute;top:10px;right:0;height:30px;width:30px;border-radius:50%;display:grid;place-items:center}.left-column-header[_ngcontent-%COMP%]   .title_wrapper[_ngcontent-%COMP%]   .custom-close-btn[_ngcontent-%COMP%]:hover{background-color:#68a86a50;cursor:pointer}.left-column-header[_ngcontent-%COMP%]   .title_wrapper[_ngcontent-%COMP%]   .close-icon[_ngcontent-%COMP%]{display:none}.left-column-header[_ngcontent-%COMP%]   .title_wrapper[_ngcontent-%COMP%]   .close-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.left-column-header[_ngcontent-%COMP%]   .title_wrapper[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700;font-size:max(1.5rem,.5vw);margin-top:1rem}.left-column-header[_ngcontent-%COMP%]   .message-search[_ngcontent-%COMP%]{margin-top:1rem;display:flex;align-items:center;justify-content:space-between;width:100%;gap:.1rem;border:1px solid rgba(128,128,128,.247);border-radius:5px}.left-column-header[_ngcontent-%COMP%]   .message-search[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:50px;width:20%;height:100%;display:flex;justify-content:center;align-items:center;color:#68a86a;cursor:pointer}.left-column-header[_ngcontent-%COMP%]   .message-search[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:30px;height:auto;width:auto}.left-column-header[_ngcontent-%COMP%]   .message-search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;outline:none;background-color:transparent;height:100%;width:100%;font-size:1rem;padding:1rem}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]{flex:1;margin:0 0 1rem;display:flex;flex-direction:column;gap:.5rem}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .active-card-list[_ngcontent-%COMP%]{background-color:#d3d3d360;border-color:#68a86a;border-width:2px}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]{height:6.5rem;min-height:6.5rem;max-height:6.5rem;width:100%;gap:1rem;padding:.5rem .75rem}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card-content[_ngcontent-%COMP%]{margin-top:.25rem;display:flex;align-items:flex-start;justify-content:flex-start;gap:15px}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{max-width:35px;min-width:35px;min-height:35px;height:35px;width:35px;border-radius:50%;overflow:hidden}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]   .message-name[_ngcontent-%COMP%]{width:100%}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]   .message-name[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:clamp(1rem,.8vw,5rem);font-weight:bolder;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]   .message-name[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{font-size:.8rem;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;text-overflow:ellipsis;max-height:3em;line-height:1.5em}.left-column[_ngcontent-%COMP%]   .list-card-message[_ngcontent-%COMP%]   .list-card[_ngcontent-%COMP%]   .time-sent[_ngcontent-%COMP%]{text-align:right;color:#68a86a;font-size:.8rem}"]})}return i})();var x=a(5716),O=a(3267),b=a(1572);function D(i,c){if(1&i&&(e.TgZ(0,"div",5)(1,"div",6)(2,"div",7),e._UZ(3,"img",8),e.qZA(),e.TgZ(4,"div",9),e._uU(5),e.qZA()()()),2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(3),e.s9C("src",n.imgSrc(t.from.img),e.LSH),e.Q6J("draggable",!1),e.xp6(2),e.hij(" ",t.text," ")}}function L(i,c){if(1&i&&(e.TgZ(0,"div",10)(1,"div",11)(2,"div",9),e._uU(3),e.qZA()()()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.hij(" ",t.text," ")}}function R(i,c){if(1&i&&(e.TgZ(0,"div",2),e.YNc(1,D,6,3,"div",3),e.YNc(2,L,4,1,"div",4),e.qZA()),2&i){const t=c.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngIf",t.from._id!==n.token.sub),e.xp6(1),e.Q6J("ngIf",t.from._id===n.token.sub)}}function S(i,c){1&i&&(e.TgZ(0,"div",12)(1,"span",13),e._UZ(2,"mat-spinner",14),e._uU(3," Loading messages..."),e.qZA()()),2&i&&(e.xp6(2),e.Q6J("diameter",15))}let N=(()=>{class i{constructor(t,n){this._token=t,this._util=n,this.messageList=[],this.messageLoading=!1}ngOnInit(){this.token=this._token.decodedToken()}fullName(t){return this._util.constructName(t)}imgSrc(t){return this._util.setImgUrl(t)}duration(t){return this._util.calculateMessageDuration(t)}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(p.B),e.Y36(v.M))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-message-content"]],inputs:{messageList:"messageList",messageLoading:"messageLoading"},decls:2,vars:2,consts:[["style","padding: 1rem",4,"ngFor","ngForOf"],["class","message-loading",4,"ngIf"],[2,"padding","1rem"],["class","sender",4,"ngIf"],["class","receiver",4,"ngIf"],[1,"sender"],[1,"sender-wrapper"],[1,"avatar"],["loading","lazy","alt","Avatar",3,"src","draggable"],[1,"message","card"],[1,"receiver"],[1,"receiver-wrapper"],[1,"message-loading"],[2,"display","flex","align-items","center","justify-content","center","gap","0.5rem"],[3,"diameter"]],template:function(n,s){1&n&&(e.YNc(0,R,3,2,"div",0),e.YNc(1,S,4,1,"div",1)),2&n&&(e.Q6J("ngForOf",s.messageList),e.xp6(1),e.Q6J("ngIf",s.messageLoading))},dependencies:[m.sg,m.O5,b.Ou],styles:[".message-loading[_ngcontent-%COMP%]{padding:.5rem 0}.sender[_ngcontent-%COMP%]   .sender-wrapper[_ngcontent-%COMP%]{display:flex;gap:1rem;max-width:20rem}.sender[_ngcontent-%COMP%]   .sender-wrapper[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{max-width:35px;min-width:35px;width:35px;max-height:35px;min-height:35px;height:35px;border-radius:50%;overflow:hidden}.sender[_ngcontent-%COMP%]   .sender-wrapper[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{object-fit:cover;border-radius:50%;width:100%;height:100%}.sender[_ngcontent-%COMP%]   .sender-wrapper[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{padding:1rem;background-color:#d9d9d9}.receiver[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.receiver[_ngcontent-%COMP%]   .receiver-wrapper[_ngcontent-%COMP%]{display:flex;gap:1rem;max-width:20rem}.receiver[_ngcontent-%COMP%]   .receiver-wrapper[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{max-width:35px}.receiver[_ngcontent-%COMP%]   .receiver-wrapper[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}.receiver[_ngcontent-%COMP%]   .receiver-wrapper[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{background-color:#68a86a;padding:1rem;color:#fff}"]})}return i})();var d=a(4006);let A=(()=>{class i{constructor(t,n,s){this.fb=t,this._token=n,this._socket=s,this.roomDetails=null,this.selectedRoomId="",this.setNewMessage=new e.vpe,this.isLoading=!1,this.messageErrors=[{field:"message",error:"required",message:"Message is required."},{field:"message",error:"maxlength",message:"Message must not exceed 1000 characters."}]}ngOnInit(){this.token=this._token.decodedToken(),this.messageForm=this.fb.group({message:new d.NI("",{validators:[d.kI.required,d.kI.maxLength(1e3)]})})}getMyName(t){return t.find(s=>s._id===this.token.sub)}onSubmit(t){if(""===this.selectedRoomId||!t.valid)return;const n=t.getRawValue(),s={roomId:this.roomDetails?._id,from:this.token.sub,type:"text",text:n.message};this._socket.emit("MsgSocket","msg:chat:receive",s);const o={_id:"",roomId:this.roomDetails?._id,from:{_id:this.token.sub,name:this.getMyName(this.roomDetails?.members)?.name,img:this.token.img},type:s.type,isRead:!1,createdAt:(new Date).toISOString()};"text"===s.type&&(o.text=s.text),this.setNewMessage.emit(o),t.reset()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(d.qu),e.Y36(p.B),e.Y36(x.$c))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-message-form"]],inputs:{roomDetails:"roomDetails",selectedRoomId:"selectedRoomId"},outputs:{setNewMessage:"setNewMessage"},decls:12,vars:3,consts:[[3,"formGroup","ngSubmit"],[1,"form"],[1,"input-form"],[1,"input-form-wrapper"],["formControlName","message","type","text","name","input-form","value","","placeholder","Message here...",3,"disabled"],[1,"icons-form-wrapper"],["type","submit",1,"mat-icon",3,"disabled"],[1,"mat-icon"]],template:function(n,s){1&n&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return s.onSubmit(s.messageForm)}),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3),e._UZ(4,"input",4),e.qZA(),e.TgZ(5,"div",5)(6,"button",6)(7,"mat-icon"),e._uU(8,"send"),e.qZA()(),e.TgZ(9,"div",7)(10,"mat-icon"),e._uU(11,"image"),e.qZA()()()()()()),2&n&&(e.Q6J("formGroup",s.messageForm),e.xp6(4),e.Q6J("disabled",s.isLoading),e.xp6(2),e.Q6J("disabled",s.isLoading||""===s.selectedRoomId))},dependencies:[M.Hw,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u],styles:[".form[_ngcontent-%COMP%]{border-top:1px solid lightgray;padding:1rem;width:100%}.form[_ngcontent-%COMP%]   .input-form[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;width:100%}.form[_ngcontent-%COMP%]   .input-form[_ngcontent-%COMP%]   .input-form-wrapper[_ngcontent-%COMP%]{flex:1;background-color:#fff;box-shadow:1px 1px 5px #8887;border-radius:5px}.form[_ngcontent-%COMP%]   .input-form[_ngcontent-%COMP%]   .input-form-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:1rem;border:none;outline:none;font-size:clamp(1rem,.8vw,8rem);background-color:transparent}.form[_ngcontent-%COMP%]   .input-form[_ngcontent-%COMP%]   .icons-form-wrapper[_ngcontent-%COMP%]{flex:0;display:flex;gap:1rem}.form[_ngcontent-%COMP%]   .input-form[_ngcontent-%COMP%]   .icons-form-wrapper[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#68a86a;border:none;outline:none;background-color:transparent;width:-moz-fit-content;width:fit-content;height:-moz-fit-content;height:fit-content;cursor:pointer}"]})}return i})();function J(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",13),e.NdJ("click",function(){e.CHM(t),e.oxw();const s=e.MAs(2);return e.KtG(s.toggle())}),e.TgZ(1,"mat-icon"),e._uU(2,"menu"),e.qZA()()}}function U(i,c){if(1&i&&(e.TgZ(0,"div",14)(1,"div",15),e._UZ(2,"img",16),e.qZA(),e.TgZ(3,"div",17),e._uU(4),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.s9C("src",t.imgSrc,e.LSH),e.Q6J("draggable",!1),e.xp6(2),e.Oqu(t.fullName)}}function Y(i,c){1&i&&(e.TgZ(0,"div")(1,"div",18),e._uU(2," No Selected Conversation Yet. "),e.qZA()())}function F(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"app-message-content",19),e.NdJ("scroll",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.handleContentScroll(s))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("messageList",t.messageList)("messageLoading",t.isLoading)}}function Q(i,c){1&i&&(e.TgZ(0,"div",20),e._uU(1," Select conversation. "),e.qZA())}function j(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"app-message-form",21),e.NdJ("setNewMessage",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.handleUpdateMessageList(s))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("roomDetails",t.roomDetails)("selectedRoomId",t.selectedRoomId)}}const q=[{path:"",component:(()=>{class i{constructor(t,n,s,o,r){this.breakpointObserver=t,this._util=n,this._token=s,this._socket=o,this._message=r,this.isMobile=!1,this.isLoading=!1,this.isLastPage=!1,this.subscription=new h.w0,this._snack=(0,e.f3M)(g.ux),this.selectedRoomId="",this.roomDetails=null,this.messageList=[],this.limit=20,this.page=1}ngOnInit(){this.token=this._token.decodedToken(),this._initSocket(),this.subscription.add(this.breakpointObserver.observe([f.u3.Handset]).subscribe(t=>{this.isMobile=t.matches})),this._socket.listen("MsgSocket","msg:chat:send").subscribe({next:t=>{const n={_id:t._id,roomId:t.roomId,from:{_id:t.from._id,name:t.from.name,img:t.from.img},type:t.type,isRead:t.isRead,createdAt:t.createdAt};"text"===t.type?n.text=t.text:n.media=t.media,this.messageList.unshift(n),this.messageSideNavComponent.updateRoomData(n)},error:t=>{}})}handleUpdateMessageList(t){this.messageList.unshift(t),this.messageSideNavComponent.updateRoomData(t)}ngOnDestroy(){this._socket.disconnectMsg(),this.subscription&&this.subscription.unsubscribe()}updateMessages(t){this.messageList=t}updateSelectedRoomId(t){this.selectedRoomId=t}updateRoomDetails(t){this.roomDetails=t}getOtherMember(t){return t.find(s=>s._id!==this.token.sub)}get fullName(){const t=this.getOtherMember(this.roomDetails?.members);return this._util.constructName(t?.name)}get imgSrc(){const t=this.getOtherMember(this.roomDetails?.members);return this._util.setImgUrl(t?.img)}duration(t){return this._util.calculateMessageDuration(t)}_initSocket(){this._socket.initMsg(),this._socket.emit("MsgSocket","msg:join",this.token.sub),this.subscription.add(this._socket.listen("MsgSocket","disconnect").subscribe(()=>{})),this.subscription.add(this._socket.defaultEventMsg("reconnect_attempt").subscribe(t=>{})),this.subscription.add(this._socket.defaultEventMsg("reconnect").subscribe(()=>{this._socket.emit("MsgSocket","msg:join",this.token.sub)}))}handleContentScroll(t){const{clientHeight:n,scrollHeight:s,scrollTop:o}=t.target;s===Math.abs(o)+n&&!1===this.isLoading&&(this.isLoading=!0,this.subscription.add(this._message.getRoomMessages(this.roomDetails?._id,this.limit,this.page+1).subscribe({next:r=>{if(r.length>0){const C=this.sortMessage(r);return this.messageList=[...this.messageList,...C],this.page=this.page+1,void(this.isLoading=!1)}this.isLoading=!1},error:r=>{this._snack.open(r.error.code,"",{duration:1e3}),this.isLoading=!1}})))}sortMessage(t){return t.sort((n,s)=>new Date(s.createdAt).getTime()-new Date(n.createdAt).getTime())}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(f.Yg),e.Y36(v.M),e.Y36(p.B),e.Y36(x.$c),e.Y36(l.e))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-message-page"]],viewQuery:function(n,s){if(1&n&&e.Gf(P,5),2&n){let o;e.iGM(o=e.CRH())&&(s.messageSideNavComponent=o.first)}},decls:13,vars:12,consts:[[1,"messenger"],[1,"message-list",3,"mode","opened"],["drawer",""],[3,"isMobile","togleDrawer","limit","page","setMessages","setSelectedId","setRoomDetails"],[1,"message-content"],[1,"header"],["class","message-menu",3,"click",4,"ngIf"],["class","header-user",4,"ngIf"],[4,"ngIf"],[1,"messages"],["class","messages-wrapper",3,"messageList","messageLoading","scroll",4,"ngIf"],["class","no-message-found",4,"ngIf"],[3,"roomDetails","selectedRoomId","setNewMessage",4,"ngIf"],[1,"message-menu",3,"click"],[1,"header-user"],[1,"avatar"],["loading","lazy","alt","Avatar",3,"src","draggable"],[1,"name"],[1,"name",2,"padding","0.75rem 0"],[1,"messages-wrapper",3,"messageList","messageLoading","scroll"],[1,"no-message-found"],[3,"roomDetails","selectedRoomId","setNewMessage"]],template:function(n,s){if(1&n&&(e.TgZ(0,"mat-drawer-container",0)(1,"mat-drawer",1,2)(3,"app-message-sidenav",3),e.NdJ("setMessages",function(r){return s.updateMessages(r)})("setSelectedId",function(r){return s.updateSelectedRoomId(r)})("setRoomDetails",function(r){return s.updateRoomDetails(r)}),e.qZA()(),e.TgZ(4,"main",4)(5,"div",5),e.YNc(6,J,3,0,"div",6),e.YNc(7,U,5,3,"div",7),e.YNc(8,Y,3,0,"div",8),e.qZA(),e.TgZ(9,"div",9),e.YNc(10,F,1,2,"app-message-content",10),e.YNc(11,Q,2,0,"div",11),e.YNc(12,j,1,2,"app-message-form",12),e.qZA()()()),2&n){const o=e.MAs(2);e.xp6(1),e.Q6J("mode",s.isMobile?"over":"side")("opened",!s.isMobile),e.xp6(2),e.Q6J("isMobile",s.isMobile)("togleDrawer",o.toggle.bind(o))("limit",s.limit)("page",s.page),e.xp6(3),e.Q6J("ngIf",s.isMobile),e.xp6(1),e.Q6J("ngIf",""!==s.selectedRoomId),e.xp6(1),e.Q6J("ngIf",""===s.selectedRoomId),e.xp6(2),e.Q6J("ngIf",""!==s.selectedRoomId),e.xp6(1),e.Q6J("ngIf",""===s.selectedRoomId),e.xp6(1),e.Q6J("ngIf",s.roomDetails)}},dependencies:[m.O5,M.Hw,O.jA,O.kh,P,N,A],styles:[".messenger[_ngcontent-%COMP%]{width:100%;height:calc(100vh - 4rem);border-left:1px solid lightgray;border-right:1px solid lightgray}.messenger[_ngcontent-%COMP%]   .no-message-found[_ngcontent-%COMP%]{flex:1;display:grid;place-items:center;font-weight:700;color:gray}.messenger[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]{width:20rem;max-width:20rem;min-width:20rem;height:100%;border:none}.messenger[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:stretch;justify-items:center}.messenger[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]{flex:1;height:calc(100% - 10rem);display:flex;flex-direction:column;align-items:stretch;justify-items:center}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;padding:1rem;border-bottom:1px solid rgb(224,224,224)}.messenger[_ngcontent-%COMP%]   .header-user[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;gap:12px}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{max-width:35px;min-width:35px;width:35px;max-height:35px;min-height:35px;height:35px;border-radius:50%;overflow:hidden}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;object-fit:cover}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:clamp(1rem,.8vw,8rem);font-weight:bolder}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .message-menu[_ngcontent-%COMP%]{cursor:pointer;height:2.8rem;width:2.8rem;border-radius:100%}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .message-menu[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.messenger[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .message-menu[_ngcontent-%COMP%]:hover{background-color:#000;color:#68a86a}.messages-wrapper[_ngcontent-%COMP%]{flex:1;overflow:auto;display:flex;flex-direction:column-reverse}"],data:{animation:[y.B]}})}return i})()}];let z=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[_.Bz.forChild(q),_.Bz]})}return i})(),E=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[m.ez,z,M.Ps,O.SJ,d.u5,d.UX,b.Cq,g.ZX]})}return i})()},2684:(w,u,a)=>{a.d(u,{e:()=>e});var m=a(2340),_=a(4650),f=a(529);let e=(()=>{class h{constructor(g){this._http=g}messageProprietor(g,l,p){return this._http.post(`${m.N.api}/api/message/post/send-msg/${l}`,g,{withCredentials:!0,headers:{"X-XSRF-TOKEN":p}})}sendMessage(g,l,p){return this._http.post(`${m.N.api}/api/message/post/send-msg/${l}`,g,{withCredentials:!0,headers:{"X-XSRF-TOKEN":p}})}getMessageRoomsByUserId(g){return this._http.get(`${m.N.api}/api/message/get/rooms/${g}`)}getRoomMessages(g,l,p){return this._http.get(`${m.N.api}/api/message/get/message-thread/${g}/${p}/${l}`)}static#e=this.\u0275fac=function(l){return new(l||h)(_.LFG(f.eN))};static#t=this.\u0275prov=_.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()}}]);